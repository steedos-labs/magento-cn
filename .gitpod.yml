image: ecr.aws.steedos.cn/dockerhub/steedos/gitpod-workspace-base:2.2.5

# List the ports you want to expose and what to do when they are served. See https://www.gitpod.io/docs/config-ports/
ports:
  - port: 80
    onOpen: ignore
    visibility: public

# List the start up tasks. You can start them in parallel in multiple terminals. See https://www.gitpod.io/docs/config-start-tasks/
tasks:
  - name: magento
    command: |
      export MAGENTO_URL=$(gp url 80)
      export MAGENTO_HOST=${MAGENTO_URL/https:\/\//}
      echo "MAGENTO_HOST=$(MAGENTO_HOST)" >> magento/.env
      
      docker-compose up
